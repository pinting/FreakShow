[gd_scene load_steps=29 format=2]

[ext_resource path="res://Scenes/Demos/StressTestDemo.gd" type="Script" id=1]
[ext_resource path="res://Game/BaseScene.tscn" type="PackedScene" id=2]
[ext_resource path="res://Animations/Player00.tres" type="SpriteFrames" id=3]
[ext_resource path="res://Prefabs/Light/Light_Street.tscn" type="PackedScene" id=4]
[ext_resource path="res://Prefabs/Static/Static_StreetLamp00.tscn" type="PackedScene" id=5]
[ext_resource path="res://Game/Player.tscn" type="PackedScene" id=6]
[ext_resource path="res://Game/GameCamera.tscn" type="PackedScene" id=7]
[ext_resource path="res://Prefabs/Loop.tscn" type="PackedScene" id=8]
[ext_resource path="res://Prefabs/Pickable/Pickable_BeachBall.tscn" type="PackedScene" id=9]
[ext_resource path="res://Prefabs/Static/Static_BallHoop.tscn" type="PackedScene" id=10]
[ext_resource path="res://Prefabs/Effect/ScreenEffect_CRT.tscn" type="PackedScene" id=11]
[ext_resource path="res://Prefabs/Static/Static_Building00.tscn" type="PackedScene" id=12]
[ext_resource path="res://Prefabs/Static/Static_Car00.tscn" type="PackedScene" id=13]
[ext_resource path="res://Prefabs/Effect/ScreenEffect_Sky.tscn" type="PackedScene" id=14]
[ext_resource path="res://Prefabs/Effect/ScreenEffect_Fog.tscn" type="PackedScene" id=15]
[ext_resource path="res://Assets/Environmnent/Road00.png" type="Texture" id=16]
[ext_resource path="res://Assets/Environmnent/Dirt00.png" type="Texture" id=17]
[ext_resource path="res://Assets/Environmnent/Light01.png" type="Texture" id=18]
[ext_resource path="res://Assets/Environmnent/Surface/Wall05.png" type="Texture" id=19]
[ext_resource path="res://Assets/Environmnent/Surface/Floor02.png" type="Texture" id=20]
[ext_resource path="res://Assets/Environmnent/Decoration/Graffiti40.png" type="Texture" id=21]
[ext_resource path="res://Assets/Environmnent/Foot01.png" type="Texture" id=22]
[ext_resource path="res://Animations/Player01.tres" type="SpriteFrames" id=23]

[sub_resource type="Environment" id=1]
background_mode = 4
glow_enabled = true
glow_intensity = 1.0
glow_strength = 1.4
glow_hdr_threshold = 0.4

[sub_resource type="Shader" id=2]
code = "shader_type canvas_item;
render_mode blend_mix;

uniform float time_offset = 0;

vec2 hash(vec2 p)
{
	uvec2 q = uvec2(ivec2(p)) * uvec2(15, 40);
	q = (q.x ^ q.y) * uvec2(1, 1);

	return vec2(q) * (1.0 / float(90));
}

float worley(vec2 uv, float time)
{
	uv *= 10.0;
	uv += time * 0.25;
	
	vec2 id = floor(uv);
	vec2 gv = fract(uv);
	
	float minDist = 100.0;

	for (float y = -1.; y <= 1.; ++y)
	{
		for(float x = -1.; x <= 1.; ++x)
		{
			vec2 offset = vec2(x, y);
			vec2 h = hash(id + offset) * 0.8 + 0.1;
			
			h = (((sin(h * time) + 1.0) * 0.5) * 0.8 + 0.1) + offset;

			float p = length(gv - h);

			if (p < minDist)
			{
				minDist = p;
			}
		}
	}
	
	return minDist;
}

vec4 a(vec2 uv, float time)
{
	float t = time * 1.0;
	float l = uv.x;
	
	float r = sin(t * 0.51 + l * 1.5 + 93.0) + sin(t * 0.12 + l * 3.2 + 35.0);
	float g = sin(t * 0.37 - l * 1.7 + 12.1) + sin(t * 0.17 + l * 1.9 - 85.0);
	float b = sin(t * 0.45 + l * 2.1 + 15.0) + sin(t * 0.22 + l * 2.5 + 95.0);
	
	vec3 col = vec3(r, g, b) * 0.2 + 0.5;
	
	return vec4(col * uv.y * (1.0 - uv.y) * 4.0, 1.0);
} 

vec4 b(vec2 uv, float time, vec2 resolution)
{
	float aspect_ratio = resolution.x / resolution.y;

	uv.x *= aspect_ratio;
	
	vec3 col = vec3(0.0);
	float w = worley(uv, time);

	col += 1.0 - w;
	col.r *= smoothstep(1.7, 0.0, length(uv - (sin(vec2(0.7, 0.5) + time) + 1.0) * 0.5));
	uv.x = 1.2 - uv.x;
	col.g *= smoothstep(1.7, 0.0, length(uv - (cos(0.5 + time) + 1.0) * 0.5));
	col.b *= 1.0 - sin(col.r + col.g);
	
	return vec4(col, 1.0 - ((col.r + col.g + col.b) / 3.0));
}

void fragment()
{
    vec2 resolution = 1.0 / SCREEN_PIXEL_SIZE;
    float time = TIME + time_offset;

	vec4 ra = a(UV, time);
    vec4 rb = b(UV, time, resolution);

    COLOR = vec4((ra.r + rb.r) / 2.0, (ra.g + rb.g) / 2.0, (ra.b + rb.b) / 2.0, rb.a);
}"

[sub_resource type="ShaderMaterial" id=3]
shader = SubResource( 2 )
shader_param/time_offset = 30000.0

[sub_resource type="RectangleShape2D" id=4]
extents = Vector2( 6015.19, 55.4996 )

[sub_resource type="RectangleShape2D" id=5]
extents = Vector2( 4997.92, 4558.86 )

[node name="LoopDemo" type="Node2D"]

[node name="BaseScene" parent="." instance=ExtResource( 2 )]
script = ExtResource( 1 )

[node name="Player" parent="BaseScene" instance=ExtResource( 6 )]
position = Vector2( -2300.73, 922.184 )
scale = Vector2( 0.7, 0.7 )
animation_frames = ExtResource( 3 )

[node name="GameCamera" parent="BaseScene" instance=ExtResource( 7 )]
position = Vector2( 1727.88, 673.351 )
scale = Vector2( 0.7, 0.7 )
zoom = Vector2( 4, 4 )
smoothing_speed = 1.0
follow_node = NodePath("../Player")
follow_init_offset = Vector2( 0, -500 )
follow_offset = Vector2( 0, -500 )

[node name="Darkness" type="CanvasModulate" parent="BaseScene"]
light_mask = 0
color = Color( 0.294118, 0.294118, 0.294118, 1 )

[node name="WorldEnvironment" type="WorldEnvironment" parent="BaseScene"]
environment = SubResource( 1 )

[node name="Sky" parent="BaseScene" instance=ExtResource( 14 )]

[node name="Fog" parent="BaseScene" instance=ExtResource( 15 )]

[node name="ScreenEffect" parent="BaseScene" instance=ExtResource( 11 )]

[node name="Environment" type="Node2D" parent="BaseScene"]
position = Vector2( 99.8936, -23.7839 )

[node name="Ball" parent="BaseScene/Environment" instance=ExtResource( 9 )]
position = Vector2( -2121.54, 1207.89 )

[node name="Loop" parent="BaseScene/Environment" instance=ExtResource( 8 )]
position = Vector2( 1630.16, 875.011 )
player_node = NodePath("../../Player")
area_shape_node = NodePath("Area/Shape")
container_node = NodePath("Container")

[node name="Container" type="Node2D" parent="BaseScene/Environment/Loop"]

[node name="Building" parent="BaseScene/Environment/Loop/Container" instance=ExtResource( 12 )]
position = Vector2( 7.72876, -2215.99 )
z_index = -3

[node name="Road" type="Sprite" parent="BaseScene/Environment/Loop/Container"]
position = Vector2( 0, 435.019 )
z_index = -2
texture = ExtResource( 16 )
region_enabled = true
region_rect = Rect2( 0, 0, 10000, 300 )

[node name="Dirt" type="Sprite" parent="BaseScene/Environment/Loop/Container/Road"]
position = Vector2( 0, 286.343 )
texture = ExtResource( 17 )
region_enabled = true
region_rect = Rect2( 0, 0, 10000, 300 )

[node name="Lamp00" parent="BaseScene/Environment/Loop/Container/Road" instance=ExtResource( 5 )]
position = Vector2( -1188.94, -939.155 )
z_index = -1

[node name="Light" parent="BaseScene/Environment/Loop/Container/Road/Lamp00" instance=ExtResource( 4 )]
position = Vector2( -290.091, 915.182 )

[node name="Lamp01" parent="BaseScene/Environment/Loop/Container/Road" instance=ExtResource( 5 )]
position = Vector2( 1310.07, -936.155 )
z_index = -1

[node name="Light" parent="BaseScene/Environment/Loop/Container/Road/Lamp01" instance=ExtResource( 4 )]
position = Vector2( -290.091, 915.182 )

[node name="Hoop" parent="BaseScene/Environment/Loop/Container/Road" instance=ExtResource( 10 )]
position = Vector2( 929.641, -607.338 )
collision_layer = 0

[node name="OverlayBody" parent="BaseScene/Environment/Loop/Container/Road/Hoop/Sprite/Overlay" index="0"]
collision_layer = 0
collision_mask = 0

[node name="Car" parent="BaseScene/Environment/Loop/Container/Road" instance=ExtResource( 13 )]
position = Vector2( -1028.8, -256.482 )

[node name="Showcase" type="Node2D" parent="BaseScene/Environment/Loop/Container/Road"]
position = Vector2( 3710.33, -546.259 )

[node name="Foot" type="Sprite" parent="BaseScene/Environment/Loop/Container/Road/Showcase"]
position = Vector2( -146.088, 277.709 )
texture = ExtResource( 22 )
region_enabled = true
region_rect = Rect2( 0, 0, 1000, 300 )

[node name="Wall" type="Sprite" parent="BaseScene/Environment/Loop/Container/Road/Showcase/Foot"]
position = Vector2( -0.380859, -494.291 )
texture = ExtResource( 19 )
region_enabled = true
region_rect = Rect2( 0, 0, 1000, 600 )

[node name="Floor" type="Sprite" parent="BaseScene/Environment/Loop/Container/Road/Showcase/Foot/Wall"]
position = Vector2( 0, 280.621 )
texture = ExtResource( 20 )
region_enabled = true
region_rect = Rect2( 0, 0, 1000, 140 )

[node name="Heart00" type="Sprite" parent="BaseScene/Environment/Loop/Container/Road/Showcase/Foot/Wall"]
self_modulate = Color( 1, 1, 1, 0.588235 )
position = Vector2( 373.371, -99.3281 )
rotation = 0.199736
scale = Vector2( 0.288446, 0.288446 )
texture = ExtResource( 21 )

[node name="Heart01" type="Sprite" parent="BaseScene/Environment/Loop/Container/Road/Showcase/Foot/Wall"]
self_modulate = Color( 1, 1, 1, 0.588235 )
position = Vector2( -317.014, 52.728 )
rotation = 0.181321
scale = Vector2( 0.288446, 0.288446 )
texture = ExtResource( 21 )

[node name="AnimatedSprite" type="AnimatedSprite" parent="BaseScene/Environment/Loop/Container/Road/Showcase/Foot/Wall"]
position = Vector2( -9.64124, 61.9118 )
scale = Vector2( 0.489617, 0.489617 )
frames = ExtResource( 23 )
animation = "fap"
frame = 12
playing = true

[node name="Light2D" type="Light2D" parent="BaseScene/Environment/Loop/Container/Road/Showcase/Foot/Wall/AnimatedSprite"]
scale = Vector2( 5, 3 )
texture = ExtResource( 18 )

[node name="Effect" type="ColorRect" parent="BaseScene/Environment/Loop/Container/Road/Showcase"]
self_modulate = Color( 1, 1, 1, 0.588235 )
material = SubResource( 3 )
margin_left = -643.0
margin_top = -512.834
margin_right = 357.0
margin_bottom = 132.166
mouse_filter = 2
color = Color( 0.972549, 0.972549, 0.972549, 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Walls" type="StaticBody2D" parent="BaseScene/Environment/Loop/Container"]
position = Vector2( 0, 369.757 )
z_index = -2
collision_layer = 7
collision_mask = 7

[node name="Bottom" type="CollisionShape2D" parent="BaseScene/Environment/Loop/Container/Walls"]
position = Vector2( 0, 105.514 )
z_index = 1
shape = SubResource( 4 )

[node name="Area" type="Area2D" parent="BaseScene/Environment/Loop"]

[node name="Shape" type="CollisionShape2D" parent="BaseScene/Environment/Loop/Area"]
visible = false
shape = SubResource( 5 )

[node name="Trigger" type="Node2D" parent="BaseScene"]

[node name="Sound" type="Node" parent="BaseScene"]

[editable path="BaseScene/Environment/Loop/Container/Road/Hoop"]
